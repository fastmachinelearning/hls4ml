
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Profiling Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="CONCEPTS.html" />
    
    
    <link rel="prev" href="COMMAND.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    hls4ml
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="RELEASENOTES.html">
            
                <a href="RELEASENOTES.html">
            
                    
                    Release Notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="STATUS.html">
            
                <a href="STATUS.html">
            
                    
                    Status and Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="SETUP.html">
            
                <a href="SETUP.html">
            
                    
                    Setup
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="setup/DEPENDENCIES.html">
            
                <a href="setup/DEPENDENCIES.html">
            
                    
                    Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="setup/QUICKSTART.html">
            
                <a href="setup/QUICKSTART.html">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="setup/CONFIGURATION.html">
            
                <a href="setup/CONFIGURATION.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="COMMAND.html">
            
                <a href="COMMAND.html">
            
                    
                    Command help
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6" data-path="PROFILING.html">
            
                <a href="PROFILING.html">
            
                    
                    Profiling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="CONCEPTS.html">
            
                <a href="CONCEPTS.html">
            
                    
                    Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="REFERENCE.html">
            
                <a href="REFERENCE.html">
            
                    
                    Reference and Contributors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <a target="_blank" href="https://github.com/hls-fpga-machine-learning/HLS4ML">
            
                    
                    Code Repository
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Profiling</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="profiling">Profiling</h1>
<hr>
<p>In the <code>hls4ml</code> configuration file, it is possible to specify the model <em>Precision</em> and <em>ReuseFactor</em> with fine granularity.</p>
<p>Using a low precision can help reduce the FPGA resource usage of a model, but may result in loss of model performance if chosen inappropriately. The profiling tools in <code>hls4ml</code> help you to decide the appropriate model precision.</p>
<p>Profiling uses some extra dependencies, to install these, run <code>pip install .[profiling]</code> from the <code>hls4ml</code> root. The profiling tools are provided as a <code>Python</code> module which you can use.</p>
<p>Three types of objects can be provided: <strong>a Keras model object</strong>, <strong>test data</strong>, and an <strong>HLSModel object</strong>.
You will need to initialise these objects by using a trained model, loading a model from a file, and loading your data. The Keras model and data each need to be in the format that would normally allow you to run, e.g. <code>model.predict(X)</code>.</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> hls4ml.model.profiling <span class="hljs-keyword">import</span> numerical
<span class="hljs-keyword">from</span> hls4ml.converters <span class="hljs-keyword">import</span> keras_to_hls
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> yaml

<span class="hljs-comment"># pseudo code:</span>
model = load_model()
X = load_data()

<span class="hljs-comment"># real code:</span>
<span class="hljs-comment"># load your hls4ml .yml config file with yaml</span>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">&quot;keras-config.yml&quot;</span>, <span class="hljs-string">&apos;r&apos;</span>) <span class="hljs-keyword">as</span> ymlfile:
    config = yaml.load(ymlfile)

hls_model = keras_to_hls(config)

<span class="hljs-comment"># produce an activation profile (ap)</span>
<span class="hljs-comment"># and weights profile (wp)</span>
ap, wp = numerical(keras_model=model, hls_model = hls_model, X=X)
plt.show()
</code></pre>
<p>Calling the <code>hls4ml.model.profiling.numerical</code> method with these three objects provided will produce two figures as below:</p>
<p><img src="img/activations.png" width="350" align="left">
<img src="img/weights.png" width="350" align="right"></p>
<p><br><br><br><br><br><br><br><br><br><br><br><br></p>
<p>Different plots styles are available with the <code>plot</code> keyword argument. Valid options are <code>boxplot</code> (default), <code>histogram</code>, <code>violinplot</code>. In the default boxplot style, each variable in the neural network is evaluated using the given test data and the distribution of (non-zero) values is shown with a box and whisker diagram.</p>
<p>When different combinations of the input objects are given, different plots will be produced:</p>
<p>1) Only Keras model: only the weights profile plot will be produced, the activation profile will be <code>None</code>. No grey boxes representing the data types will be shown.</p>
<p>2) Only HLSModel (or HLSModel and Keras model): only the weights profile plot will be produced, with grey boxes indicating the data types from the HLSModel. </p>
<p>3) Keras model and data (<code>X</code>): both the weights profile and activation profile will be produced. No grey boxes representing the data types will be shown.</p>
<p>4) Keras model, HLSModel, and data: both weights and activation profiles are produced, with grey boxes indicating the data types from the HLSModel.</p>
<p>Each box shows the median and quartiles of the distribution. The grey shaded boxes show the range which can be represented with the hls4ml config file used.</p>
<p>As a starting point, a good configuration would at least cover the box and whisker for each variable with the grey box. Make sure the box and whisker is contained to the right by using sufficient integer bits to avoid overflow. It might be that more precision is needed (grey boxes extend further to the left) to achieve satisfactory performance. In some cases, it is safe to barely cover the values and still achieve good accuracy.</p>
<p>To establish whether the configuration gives good performance, run C Simulation with test data and compare the results to your model evaluated on the CPU with floating point.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="COMMAND.html" class="navigation navigation-prev " aria-label="Previous page: Command help">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="CONCEPTS.html" class="navigation navigation-next " aria-label="Next page: Concepts">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Profiling","level":"1.6","depth":1,"next":{"title":"Concepts","level":"1.7","depth":1,"path":"CONCEPTS.md","ref":"CONCEPTS.md","articles":[]},"previous":{"title":"Command help","level":"1.5","depth":1,"path":"COMMAND.md","ref":"COMMAND.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"fontSettings":{"theme":"sepia","family":"sans"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"PROFILING.md","mtime":"2020-06-27T00:17:13.259Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-06-27T00:17:58.872Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

