
import std;
import ap_types.fixed_point_fix;
import ap_types.fixed_point_lib;


// hls-fpga-machine-learning insert exponent table
const EXP_TABLE = sN[u32:18][u32:1024]:[
    sN[u32:18]:1024,sN[u32:18]:1090,sN[u32:18]:1160,sN[u32:18]:1235,sN[u32:18]:1315,sN[u32:18]:1400,sN[u32:18]:1490,sN[u32:18]:1586,
    sN[u32:18]:1688,sN[u32:18]:1797,sN[u32:18]:1913,sN[u32:18]:2036,sN[u32:18]:2168,sN[u32:18]:2308,sN[u32:18]:2456,sN[u32:18]:2615,
    sN[u32:18]:2784,sN[u32:18]:2963,sN[u32:18]:3154,sN[u32:18]:3358,sN[u32:18]:3574,sN[u32:18]:3805,sN[u32:18]:4050,sN[u32:18]:4311,
    sN[u32:18]:4589,sN[u32:18]:4885,sN[u32:18]:5200,sN[u32:18]:5536,sN[u32:18]:5893,sN[u32:18]:6273,sN[u32:18]:6677,sN[u32:18]:7108,
    sN[u32:18]:7566,sN[u32:18]:8054,sN[u32:18]:8574,sN[u32:18]:9127,sN[u32:18]:9715,sN[u32:18]:10342,sN[u32:18]:11009,sN[u32:18]:11719,
    sN[u32:18]:12475,sN[u32:18]:13279,sN[u32:18]:14136,sN[u32:18]:15048,sN[u32:18]:16018,sN[u32:18]:17051,sN[u32:18]:18151,sN[u32:18]:19321,
    sN[u32:18]:20568,sN[u32:18]:21894,sN[u32:18]:23306,sN[u32:18]:24809,sN[u32:18]:26409,sN[u32:18]:28113,sN[u32:18]:29926,sN[u32:18]:31856,
    sN[u32:18]:33910,sN[u32:18]:36097,sN[u32:18]:38425,sN[u32:18]:40904,sN[u32:18]:43542,sN[u32:18]:46350,sN[u32:18]:49339,sN[u32:18]:52521,
    sN[u32:18]:55909,sN[u32:18]:59514,sN[u32:18]:63353,sN[u32:18]:67439,sN[u32:18]:71788,sN[u32:18]:76418,sN[u32:18]:81346,sN[u32:18]:86593,
    sN[u32:18]:92178,sN[u32:18]:98122,sN[u32:18]:104451,sN[u32:18]:111187,sN[u32:18]:118358,sN[u32:18]:125992,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,sN[u32:18]:131071,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,
    sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:0,sN[u32:18]:1,
    sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,
    sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,sN[u32:18]:1,
    sN[u32:18]:2,sN[u32:18]:2,sN[u32:18]:2,sN[u32:18]:2,sN[u32:18]:2,sN[u32:18]:2,sN[u32:18]:2,sN[u32:18]:2,
    sN[u32:18]:3,sN[u32:18]:3,sN[u32:18]:3,sN[u32:18]:3,sN[u32:18]:3,sN[u32:18]:3,sN[u32:18]:4,sN[u32:18]:4,
    sN[u32:18]:4,sN[u32:18]:4,sN[u32:18]:5,sN[u32:18]:5,sN[u32:18]:5,sN[u32:18]:6,sN[u32:18]:6,sN[u32:18]:6,
    sN[u32:18]:7,sN[u32:18]:7,sN[u32:18]:8,sN[u32:18]:8,sN[u32:18]:9,sN[u32:18]:9,sN[u32:18]:10,sN[u32:18]:11,
    sN[u32:18]:11,sN[u32:18]:12,sN[u32:18]:13,sN[u32:18]:14,sN[u32:18]:15,sN[u32:18]:16,sN[u32:18]:17,sN[u32:18]:18,
    sN[u32:18]:19,sN[u32:18]:20,sN[u32:18]:21,sN[u32:18]:23,sN[u32:18]:24,sN[u32:18]:26,sN[u32:18]:27,sN[u32:18]:29,
    sN[u32:18]:31,sN[u32:18]:33,sN[u32:18]:35,sN[u32:18]:37,sN[u32:18]:40,sN[u32:18]:42,sN[u32:18]:45,sN[u32:18]:48,
    sN[u32:18]:51,sN[u32:18]:54,sN[u32:18]:58,sN[u32:18]:61,sN[u32:18]:65,sN[u32:18]:70,sN[u32:18]:74,sN[u32:18]:79,
    sN[u32:18]:84,sN[u32:18]:89,sN[u32:18]:95,sN[u32:18]:101,sN[u32:18]:108,sN[u32:18]:115,sN[u32:18]:122,sN[u32:18]:130,
    sN[u32:18]:139,sN[u32:18]:148,sN[u32:18]:157,sN[u32:18]:167,sN[u32:18]:178,sN[u32:18]:189,sN[u32:18]:202,sN[u32:18]:215,
    sN[u32:18]:228,sN[u32:18]:243,sN[u32:18]:259,sN[u32:18]:276,sN[u32:18]:293,sN[u32:18]:312,sN[u32:18]:332,sN[u32:18]:354,
    sN[u32:18]:377,sN[u32:18]:401,sN[u32:18]:427,sN[u32:18]:454,sN[u32:18]:484,sN[u32:18]:515,sN[u32:18]:548,sN[u32:18]:583,
    sN[u32:18]:621,sN[u32:18]:661,sN[u32:18]:704,sN[u32:18]:749,sN[u32:18]:797,sN[u32:18]:849,sN[u32:18]:904,sN[u32:18]:962
];


// hls-fpga-machine-learning insert inversion table
const INV_TABLE = sN[u32:18][u32:1024]:[
    sN[u32:18]:131071, sN[u32:18]:4096, sN[u32:18]:2048, sN[u32:18]:1365, sN[u32:18]:1024, sN[u32:18]:819, sN[u32:18]:683, sN[u32:18]:585, 
    sN[u32:18]:512, sN[u32:18]:455, sN[u32:18]:410, sN[u32:18]:372, sN[u32:18]:341, sN[u32:18]:315, sN[u32:18]:293, sN[u32:18]:273, 
    sN[u32:18]:256, sN[u32:18]:241, sN[u32:18]:228, sN[u32:18]:216, sN[u32:18]:205, sN[u32:18]:195, sN[u32:18]:186, sN[u32:18]:178, 
    sN[u32:18]:171, sN[u32:18]:164, sN[u32:18]:158, sN[u32:18]:152, sN[u32:18]:146, sN[u32:18]:141, sN[u32:18]:137, sN[u32:18]:132, 
    sN[u32:18]:128, sN[u32:18]:124, sN[u32:18]:120, sN[u32:18]:117, sN[u32:18]:114, sN[u32:18]:111, sN[u32:18]:108, sN[u32:18]:105, 
    sN[u32:18]:102, sN[u32:18]:100, sN[u32:18]:98, sN[u32:18]:95, sN[u32:18]:93, sN[u32:18]:91, sN[u32:18]:89, sN[u32:18]:87, 
    sN[u32:18]:85, sN[u32:18]:84, sN[u32:18]:82, sN[u32:18]:80, sN[u32:18]:79, sN[u32:18]:77, sN[u32:18]:76, sN[u32:18]:74, 
    sN[u32:18]:73, sN[u32:18]:72, sN[u32:18]:71, sN[u32:18]:69, sN[u32:18]:68, sN[u32:18]:67, sN[u32:18]:66, sN[u32:18]:65, 
    sN[u32:18]:64, sN[u32:18]:63, sN[u32:18]:62, sN[u32:18]:61, sN[u32:18]:60, sN[u32:18]:59, sN[u32:18]:59, sN[u32:18]:58, 
    sN[u32:18]:57, sN[u32:18]:56, sN[u32:18]:55, sN[u32:18]:55, sN[u32:18]:54, sN[u32:18]:53, sN[u32:18]:53, sN[u32:18]:52, 
    sN[u32:18]:51, sN[u32:18]:51, sN[u32:18]:50, sN[u32:18]:49, sN[u32:18]:49, sN[u32:18]:48, sN[u32:18]:48, sN[u32:18]:47, 
    sN[u32:18]:47, sN[u32:18]:46, sN[u32:18]:46, sN[u32:18]:45, sN[u32:18]:45, sN[u32:18]:44, sN[u32:18]:44, sN[u32:18]:43, 
    sN[u32:18]:43, sN[u32:18]:42, sN[u32:18]:42, sN[u32:18]:41, sN[u32:18]:41, sN[u32:18]:41, sN[u32:18]:40, sN[u32:18]:40, 
    sN[u32:18]:39, sN[u32:18]:39, sN[u32:18]:39, sN[u32:18]:38, sN[u32:18]:38, sN[u32:18]:38, sN[u32:18]:37, sN[u32:18]:37, 
    sN[u32:18]:37, sN[u32:18]:36, sN[u32:18]:36, sN[u32:18]:36, sN[u32:18]:35, sN[u32:18]:35, sN[u32:18]:35, sN[u32:18]:34, 
    sN[u32:18]:34, sN[u32:18]:34, sN[u32:18]:34, sN[u32:18]:33, sN[u32:18]:33, sN[u32:18]:33, sN[u32:18]:33, sN[u32:18]:32, 
    sN[u32:18]:32, sN[u32:18]:32, sN[u32:18]:32, sN[u32:18]:31, sN[u32:18]:31, sN[u32:18]:31, sN[u32:18]:31, sN[u32:18]:30, 
    sN[u32:18]:30, sN[u32:18]:30, sN[u32:18]:30, sN[u32:18]:29, sN[u32:18]:29, sN[u32:18]:29, sN[u32:18]:29, sN[u32:18]:29, 
    sN[u32:18]:28, sN[u32:18]:28, sN[u32:18]:28, sN[u32:18]:28, sN[u32:18]:28, sN[u32:18]:27, sN[u32:18]:27, sN[u32:18]:27, 
    sN[u32:18]:27, sN[u32:18]:27, sN[u32:18]:27, sN[u32:18]:26, sN[u32:18]:26, sN[u32:18]:26, sN[u32:18]:26, sN[u32:18]:26, 
    sN[u32:18]:26, sN[u32:18]:25, sN[u32:18]:25, sN[u32:18]:25, sN[u32:18]:25, sN[u32:18]:25, sN[u32:18]:25, sN[u32:18]:25, 
    sN[u32:18]:24, sN[u32:18]:24, sN[u32:18]:24, sN[u32:18]:24, sN[u32:18]:24, sN[u32:18]:24, sN[u32:18]:24, sN[u32:18]:23, 
    sN[u32:18]:23, sN[u32:18]:23, sN[u32:18]:23, sN[u32:18]:23, sN[u32:18]:23, sN[u32:18]:23, sN[u32:18]:23, sN[u32:18]:22, 
    sN[u32:18]:22, sN[u32:18]:22, sN[u32:18]:22, sN[u32:18]:22, sN[u32:18]:22, sN[u32:18]:22, sN[u32:18]:22, sN[u32:18]:21, 
    sN[u32:18]:21, sN[u32:18]:21, sN[u32:18]:21, sN[u32:18]:21, sN[u32:18]:21, sN[u32:18]:21, sN[u32:18]:21, sN[u32:18]:21, 
    sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:20, 
    sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:20, sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:19, 
    sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:19, sN[u32:18]:18, sN[u32:18]:18, 
    sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:18, 
    sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:18, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, 
    sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, sN[u32:18]:17, 
    sN[u32:18]:17, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, 
    sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, sN[u32:18]:16, 
    sN[u32:18]:16, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, 
    sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, 
    sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:15, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, 
    sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, 
    sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, sN[u32:18]:14, 
    sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, 
    sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, 
    sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, sN[u32:18]:13, 
    sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, 
    sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, 
    sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, 
    sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:12, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, 
    sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, 
    sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, 
    sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, 
    sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:11, sN[u32:18]:10, 
    sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, 
    sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, 
    sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, 
    sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, 
    sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, sN[u32:18]:10, 
    sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, 
    sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, 
    sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, 
    sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, 
    sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, 
    sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:9, 
    sN[u32:18]:9, sN[u32:18]:9, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, 
    sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, 
    sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, 
    sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, sN[u32:18]:8, 
    sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, 
    sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, 
    sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, 
    sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-8, sN[u32:18]:-9, 
    sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, 
    sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, 
    sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, 
    sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, 
    sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, 
    sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, sN[u32:18]:-9, 
    sN[u32:18]:-9, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, 
    sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, 
    sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, 
    sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, 
    sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-10, 
    sN[u32:18]:-10, sN[u32:18]:-10, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, 
    sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, 
    sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, 
    sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, 
    sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-11, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, 
    sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, 
    sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, 
    sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, sN[u32:18]:-12, 
    sN[u32:18]:-12, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, 
    sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, 
    sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, sN[u32:18]:-13, 
    sN[u32:18]:-13, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, 
    sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, 
    sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-14, sN[u32:18]:-15, sN[u32:18]:-15, 
    sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, 
    sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, sN[u32:18]:-15, 
    sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, 
    sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, sN[u32:18]:-16, 
    sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, 
    sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-17, sN[u32:18]:-18, sN[u32:18]:-18, 
    sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-18, 
    sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-18, sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-19, 
    sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-19, sN[u32:18]:-20, sN[u32:18]:-20, 
    sN[u32:18]:-20, sN[u32:18]:-20, sN[u32:18]:-20, sN[u32:18]:-20, sN[u32:18]:-20, sN[u32:18]:-20, sN[u32:18]:-20, sN[u32:18]:-20, 
    sN[u32:18]:-20, sN[u32:18]:-21, sN[u32:18]:-21, sN[u32:18]:-21, sN[u32:18]:-21, sN[u32:18]:-21, sN[u32:18]:-21, sN[u32:18]:-21, 
    sN[u32:18]:-21, sN[u32:18]:-21, sN[u32:18]:-22, sN[u32:18]:-22, sN[u32:18]:-22, sN[u32:18]:-22, sN[u32:18]:-22, sN[u32:18]:-22, 
    sN[u32:18]:-22, sN[u32:18]:-22, sN[u32:18]:-23, sN[u32:18]:-23, sN[u32:18]:-23, sN[u32:18]:-23, sN[u32:18]:-23, sN[u32:18]:-23, 
    sN[u32:18]:-23, sN[u32:18]:-23, sN[u32:18]:-24, sN[u32:18]:-24, sN[u32:18]:-24, sN[u32:18]:-24, sN[u32:18]:-24, sN[u32:18]:-24, 
    sN[u32:18]:-24, sN[u32:18]:-25, sN[u32:18]:-25, sN[u32:18]:-25, sN[u32:18]:-25, sN[u32:18]:-25, sN[u32:18]:-25, sN[u32:18]:-25, 
    sN[u32:18]:-26, sN[u32:18]:-26, sN[u32:18]:-26, sN[u32:18]:-26, sN[u32:18]:-26, sN[u32:18]:-26, sN[u32:18]:-27, sN[u32:18]:-27, 
    sN[u32:18]:-27, sN[u32:18]:-27, sN[u32:18]:-27, sN[u32:18]:-27, sN[u32:18]:-28, sN[u32:18]:-28, sN[u32:18]:-28, sN[u32:18]:-28, 
    sN[u32:18]:-28, sN[u32:18]:-29, sN[u32:18]:-29, sN[u32:18]:-29, sN[u32:18]:-29, sN[u32:18]:-29, sN[u32:18]:-30, sN[u32:18]:-30, 
    sN[u32:18]:-30, sN[u32:18]:-30, sN[u32:18]:-31, sN[u32:18]:-31, sN[u32:18]:-31, sN[u32:18]:-31, sN[u32:18]:-32, sN[u32:18]:-32, 
    sN[u32:18]:-32, sN[u32:18]:-32, sN[u32:18]:-33, sN[u32:18]:-33, sN[u32:18]:-33, sN[u32:18]:-33, sN[u32:18]:-34, sN[u32:18]:-34, 
    sN[u32:18]:-34, sN[u32:18]:-34, sN[u32:18]:-35, sN[u32:18]:-35, sN[u32:18]:-35, sN[u32:18]:-36, sN[u32:18]:-36, sN[u32:18]:-36, 
    sN[u32:18]:-37, sN[u32:18]:-37, sN[u32:18]:-37, sN[u32:18]:-38, sN[u32:18]:-38, sN[u32:18]:-38, sN[u32:18]:-39, sN[u32:18]:-39, 
    sN[u32:18]:-39, sN[u32:18]:-40, sN[u32:18]:-40, sN[u32:18]:-41, sN[u32:18]:-41, sN[u32:18]:-41, sN[u32:18]:-42, sN[u32:18]:-42, 
    sN[u32:18]:-43, sN[u32:18]:-43, sN[u32:18]:-44, sN[u32:18]:-44, sN[u32:18]:-45, sN[u32:18]:-45, sN[u32:18]:-46, sN[u32:18]:-46, 
    sN[u32:18]:-47, sN[u32:18]:-47, sN[u32:18]:-48, sN[u32:18]:-48, sN[u32:18]:-49, sN[u32:18]:-49, sN[u32:18]:-50, sN[u32:18]:-51, 
    sN[u32:18]:-51, sN[u32:18]:-52, sN[u32:18]:-53, sN[u32:18]:-53, sN[u32:18]:-54, sN[u32:18]:-55, sN[u32:18]:-55, sN[u32:18]:-56, 
    sN[u32:18]:-57, sN[u32:18]:-58, sN[u32:18]:-59, sN[u32:18]:-59, sN[u32:18]:-60, sN[u32:18]:-61, sN[u32:18]:-62, sN[u32:18]:-63, 
    sN[u32:18]:-64, sN[u32:18]:-65, sN[u32:18]:-66, sN[u32:18]:-67, sN[u32:18]:-68, sN[u32:18]:-69, sN[u32:18]:-71, sN[u32:18]:-72, 
    sN[u32:18]:-73, sN[u32:18]:-74, sN[u32:18]:-76, sN[u32:18]:-77, sN[u32:18]:-79, sN[u32:18]:-80, sN[u32:18]:-82, sN[u32:18]:-84, 
    sN[u32:18]:-85, sN[u32:18]:-87, sN[u32:18]:-89, sN[u32:18]:-91, sN[u32:18]:-93, sN[u32:18]:-95, sN[u32:18]:-98, sN[u32:18]:-100, 
    sN[u32:18]:-102, sN[u32:18]:-105, sN[u32:18]:-108, sN[u32:18]:-111, sN[u32:18]:-114, sN[u32:18]:-117, sN[u32:18]:-120, sN[u32:18]:-124, 
    sN[u32:18]:-128, sN[u32:18]:-132, sN[u32:18]:-137, sN[u32:18]:-141, sN[u32:18]:-146, sN[u32:18]:-152, sN[u32:18]:-158, sN[u32:18]:-164, 
    sN[u32:18]:-171, sN[u32:18]:-178, sN[u32:18]:-186, sN[u32:18]:-195, sN[u32:18]:-205, sN[u32:18]:-216, sN[u32:18]:-228, sN[u32:18]:-241, 
    sN[u32:18]:-256, sN[u32:18]:-273, sN[u32:18]:-293, sN[u32:18]:-315, sN[u32:18]:-341, sN[u32:18]:-372, sN[u32:18]:-410, sN[u32:18]:-455, 
    sN[u32:18]:-512, sN[u32:18]:-585, sN[u32:18]:-683, sN[u32:18]:-819, sN[u32:18]:-1024, sN[u32:18]:-1365, sN[u32:18]:-2048, sN[u32:18]:-4096
];


pub fn idx_from_real_val
    <TABLE_SZ: u32, NB: u32,
    N: u32 = {std::clog2(TABLE_SZ)},
    LOW_END: u32 = {if NB > N { NB - N } else { u32:0 }}> // NB-N but it the generated table influences this factor as well
    (x: sN[NB]) -> uN[N] {

    let unsgined_x = x as uN[NB];
    //let idx = (unsgined_x >> LOW_END) & ((uN[NB]:1 << N) - uN[NB]:1);
    let idx = (unsgined_x >> LOW_END);
    idx as uN[N]
}

#[test]
fn idx_from_real_val_test() {
    let x = sN[16]:256; 
    let expected = uN[10]:4;  
    assert_eq(expected, idx_from_real_val<u32:1024, u32:16>(x));

    let x = sN[16]:1024; 
    let expected = uN[10]:16;  
    assert_eq(expected, idx_from_real_val<u32:1024, u32:16>(x));

    let x = sN[18]:1024; 
    let expected = uN[10]:4;  
    assert_eq(expected, idx_from_real_val<u32:1024, u32:18>(x));
}


// =========================================================================
// ------------------------------ Softmax ----------------------------------

pub fn softmax_latency
    <NB_IN: u32, EN_IN: u32, BU_IN: u32, 
    NB_OUT: u32, EN_OUT: u32, BU_OUT: u32, 
    NB_TABLE_EXP: u32, EN_TABLE_EXP: u32, BU_TABLE_EXP: u32,
    NB_TABLE_INV: u32, EN_TABLE_INV: u32, BU_TABLE_INV: u32,
    TABLE_SZ: u32, 
    VEC_SZ: u32,
    // EXP Accum
    BE_TABLE_EXP: s32 = {fixed_point_lib::binary_exponent(EN_TABLE_EXP, BU_TABLE_EXP)}, 
    NB_ACCUM: u32 = {NB_TABLE_EXP + std::clog2(VEC_SZ)},  
    BE_ACCUM: s32 = {BE_TABLE_EXP},
    EN_ACCUM: u32 = {fixed_point_lib::is_negative(BE_ACCUM)},      // exp is negative ACCUM
    BU_ACCUM: u32 = {fixed_point_lib::binary_uexponent(BE_ACCUM)}, // unsigned exp ACCUM
    // INV Multiplication 
    BE_TABLE_INV: s32 = {fixed_point_lib::binary_exponent(EN_TABLE_INV, BU_TABLE_INV)}, 
    EXP_SUM: s32 = {BE_TABLE_INV + BE_TABLE_INV},
    NB_MUL: u32 = {NB_TABLE_INV + NB_TABLE_INV}, 
    EN_MUL: u32 = {fixed_point_lib::is_negative(EXP_SUM)},
    BU_MUL: u32 = {fixed_point_lib::binary_uexponent(EXP_SUM)}>
    (y: sN[NB_IN][VEC_SZ]) -> sN[NB_OUT][VEC_SZ] {
    
    // Compute exp() with Lookup Tables
    let exp_result = for (i, exp_vec): (u32, sN[NB_TABLE_EXP][VEC_SZ]) in u32:0..VEC_SZ {
        let exp_table_idx = idx_from_real_val<TABLE_SZ, NB_IN>(y[i]);
        update(exp_vec, i, EXP_TABLE[exp_table_idx]) 
    }(sN[NB_TABLE_EXP][VEC_SZ]:[sN[NB_TABLE_EXP]:0, ...]);

    // Sum all exponents
    let sum = for (i, acc): (u32, sN[NB_ACCUM]) in u32:0..VEC_SZ {
        fixed_point_fix::add_already_widened<NB_TABLE_EXP, EN_TABLE_EXP, BU_TABLE_EXP, NB_ACCUM, EN_ACCUM, BU_ACCUM>(exp_result[i], acc)
    }(sN[NB_ACCUM]:0);
    let truncate = fixed_point_fix::to_common_type<NB_TABLE_INV, BU_TABLE_INV, NB_ACCUM, EN_ACCUM, BU_ACCUM>(sum);
    let inv_exp_sum = INV_TABLE[idx_from_real_val<TABLE_SZ>(truncate)];

    // Compute softmax
    let softmax_result = for (i, inv_vec): (u32, sN[NB_OUT][VEC_SZ]) in u32:0..VEC_SZ {
        update(inv_vec, i, fixed_point_fix::to_common_type<NB_OUT, BU_OUT, NB_MUL, EN_MUL, BU_MUL>(
            fixed_point_fix::mul<NB_TABLE_INV, EN_TABLE_INV, BU_TABLE_INV, NB_TABLE_INV, EN_TABLE_INV, BU_TABLE_INV>
            (exp_result[i], inv_exp_sum)
        )) 
    }(sN[NB_OUT][VEC_SZ]:[sN[NB_OUT]:0, ...]);

    softmax_result
} 

pub fn softmax_stable
    <NB_IN: u32, EN_IN: u32, BU_IN: u32, 
    NB_OUT: u32, EN_OUT: u32, BU_OUT: u32, 
    NB_TABLE_EXP: u32, EN_TABLE_EXP: u32, BU_TABLE_EXP: u32,
    NB_TABLE_INV: u32, EN_TABLE_INV: u32, BU_TABLE_INV: u32,
    TABLE_SZ: u32, 
    VEC_SZ: u32,
    SHIFT_LIMIT: u32 = {NB_IN - u32:1},
    // EXP Accum
    BE_TABLE_EXP: s32 = {fixed_point_lib::binary_exponent(EN_TABLE_EXP, BU_TABLE_EXP)}, 
    NB_ACCUM: u32 = {NB_TABLE_EXP + std::clog2(VEC_SZ)},  
    BE_ACCUM: s32 = {BE_TABLE_EXP},
    EN_ACCUM: u32 = {fixed_point_lib::is_negative(BE_ACCUM)},      // exp is negative ACCUM
    BU_ACCUM: u32 = {fixed_point_lib::binary_uexponent(BE_ACCUM)}, // unsigned exp ACCUM
    // INV Multiplication 
    BE_TABLE_INV: s32 = {fixed_point_lib::binary_exponent(EN_TABLE_INV, BU_TABLE_INV)}, 
    EXP_SUM: s32 = {BE_TABLE_INV + BE_TABLE_INV},
    NB_MUL: u32 = {NB_TABLE_INV + NB_TABLE_INV}, 
    EN_MUL: u32 = {fixed_point_lib::is_negative(EXP_SUM)},
    BU_MUL: u32 = {fixed_point_lib::binary_uexponent(EXP_SUM)}>
    (y: sN[NB_IN][VEC_SZ]) -> sN[NB_OUT][VEC_SZ] {

    // Find max element
    let y_max = for (i, acc): (u32, sN[NB_IN]) in u32:0..VEC_SZ {
        std::max(y[i], acc)
    }((s32:-1 << SHIFT_LIMIT) as sN[NB_IN]);

    // Compute difference 
    let d_yi_ymax = for (i, z): (u32, sN[NB_IN][VEC_SZ]) in u32:0..VEC_SZ {
        update(z, i, fixed_point_fix::sub_already_widened<NB_IN, EN_IN, BU_IN, NB_IN, EN_IN, BU_IN>(y_max, y[i]) ) 
    }(sN[NB_IN][VEC_SZ]:[sN[NB_IN]:0, ...]);

    // Compute exp() with Lookup Tables
    let exp_result = for (i, exp_vec): (u32, sN[NB_TABLE_EXP][VEC_SZ]) in u32:0..VEC_SZ {
        let exp_table_idx = idx_from_real_val<TABLE_SZ, NB_IN>(d_yi_ymax[i]);
        update(exp_vec, i, EXP_TABLE[exp_table_idx]) 
    }(sN[NB_TABLE_EXP][VEC_SZ]:[sN[NB_TABLE_EXP]:0, ...]);

    // Sum all exponents
    let sum = for (i, acc): (u32, sN[NB_ACCUM]) in u32:0..VEC_SZ {
        fixed_point_fix::add_already_widened<NB_TABLE_EXP, EN_TABLE_EXP, BU_TABLE_EXP, NB_ACCUM, EN_ACCUM, BU_ACCUM>(exp_result[i], acc)
    }(sN[NB_ACCUM]:0);
    let truncate = fixed_point_fix::to_common_type<NB_TABLE_INV, BU_TABLE_INV, NB_ACCUM, EN_ACCUM, BU_ACCUM>(sum);
    let inv_exp_sum = INV_TABLE[idx_from_real_val<TABLE_SZ>(truncate)];

    // Compute softmax
    let softmax_result = for (i, inv_vec): (u32, sN[NB_OUT][VEC_SZ]) in u32:0..VEC_SZ {
        update(inv_vec, i, fixed_point_fix::to_common_type<NB_OUT, BU_OUT, NB_MUL, EN_MUL, BU_MUL>(
            fixed_point_fix::mul<NB_TABLE_INV, EN_TABLE_INV, BU_TABLE_INV, NB_TABLE_INV, EN_TABLE_INV, BU_TABLE_INV>
            (exp_result[i], inv_exp_sum)
        )) 
    }(sN[NB_OUT][VEC_SZ]:[sN[NB_OUT]:0, ...]);

    softmax_result
}

#[test]
fn softmax_latency_test() {
    let x = sN[16][4]:[
        sN[16]:1024,
        sN[16]:1024,
        sN[16]:1024,
        sN[16]:1024
    ];
    let expected = sN[16][4]:[
        sN[16]:258,  // Ideal 256
        sN[16]:258,
        sN[16]:258,
        sN[16]:258
    ];
    assert_eq(expected, softmax_latency        
        <u32:16, u32:1, u32:10, 
        u32:16, u32:1, u32:10, 
        u32:18, u32:1, u32:10, 
        u32:18, u32:1, u32:10,
        u32:1024>(x));

    let x = sN[16][4]:[
        sN[16]:2048,
        sN[16]:2048,
        sN[16]:2048,
        sN[16]:2048
    ];
    let expected = sN[16][4]:[
        sN[16]:258,  // Ideal 256
        sN[16]:258,
        sN[16]:258,
        sN[16]:258
    ];
    assert_eq(expected, softmax_latency        
        <u32:16, u32:1, u32:10, 
        u32:16, u32:1, u32:10, 
        u32:18, u32:1, u32:10, 
        u32:18, u32:1, u32:10,
        u32:1024>(x));
}

#[test]
fn softmax_stable_test() {
    let x = sN[16][4]:[
        sN[16]:1024,
        sN[16]:1024,
        sN[16]:1024,
        sN[16]:1024
    ];
    let expected = sN[16][4]:[
        sN[16]:256,  // Ideal 256
        sN[16]:256,
        sN[16]:256,
        sN[16]:256
    ];
    assert_eq(expected, softmax_stable
        <u32:16, u32:1, u32:10, 
        u32:16, u32:1, u32:10, 
        u32:18, u32:1, u32:10, 
        u32:18, u32:1, u32:10,
        u32:1024>(x));

    let x = sN[16][4]:[
        sN[16]:4096,
        sN[16]:4096,
        sN[16]:4096,
        sN[16]:4096
    ];
    let expected = sN[16][4]:[
        sN[16]:256,  // Ideal 256
        sN[16]:256,
        sN[16]:256,
        sN[16]:256
    ];
    assert_eq(expected, softmax_stable        
        <u32:16, u32:1, u32:10, 
        u32:16, u32:1, u32:10, 
        u32:18, u32:1, u32:10, 
        u32:18, u32:1, u32:10,
        u32:1024>(x));
}


